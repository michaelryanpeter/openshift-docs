// Module included in the following assemblies:
//
// * operators/olm_v1/olmv1-installing-an-operator-from-a-catalog.adoc

:_mod-docs-content-type: PROCEDURE

[id="olmv1-finding-operators-to-install_{context}"]
= Finding Operators to install from a catalog

After you add a catalog to your cluster, you can query the catalog to find Operators and extensions to install.

include::snippets/olmv1-on-cluster-catalog-queries.adoc[]

.Prerequisites

* You have added a catalog to your cluster.
* You have installed the `jq` CLI tool.
* You have installed the `opm` CLI tool.

.Procedure

. To return a list of extensions that support the `AllNamespaces` install mode and do not use webhooks, enter the following command:
+
[source,terminal]
----
$ opm render <catalog_registry_url>:<tag> \
  | jq -r --arg pkg "" ' select(.schema == "olm.bundle" and (.package == $pkg or $pkg == "")) \
  | {package:.package, name:.name, image:.image, supportsAllNamespaces: (.properties[] \
  | select(.type == "olm.csv.metadata").value.installModes[] \
  | select(.type == "AllNamespaces").supported == true)} ' \
  | tee allNamespaces.json | jq -r '.image' \
  | xargs -I '{}' -n1 -P8 bash -c ' opm render {} > $(mktemp -d -p . -t olmv1-compat-bundle-XXXXXXXX)/bundle.json ' && bash -c 'cat olmv1-compat-bundle*/*.json' \
  | jq '{package, name, image, requiresWebhooks: (.properties[] \
  | select(.type == "olm.bundle.object").value.data | @base64d | fromjson \
  | select(.kind == "ClusterServiceVersion").spec.webhookdefinitions != null)}' > webhooks.json && jq -cs ' group_by(.name)[] \
  | reduce .[] as $item ({}; . *= $item) | . *= {compatible: ((.requiresWebhooks | not) and .supportsAllNamespaces)} \
  | {name, package, compatible} ' allNamespaces.json webhooks.json | jq -r '. \
  | select(.compatible == true) | .package' | sort -u
----
where:

`catalog_registry_url`:: Specifies the URL of the catalog registry, such as `registry.redhat.io/redhat/redhat-operator-index`.
`tag`:: Specifies the tag or version of the catalog, such as `v{product-version}` or `latest`.
+
.Example command
[%collapsible]
====
[source,terminal,subs=attributes+]
----
$ opm render \
  registry.redhat.io/redhat/redhat-operator-index:v{product-version} \
  | jq -r --arg pkg "" ' select(.schema == "olm.bundle" and (.package == $pkg or $pkg == "")) \
  | {package:.package, name:.name, image:.image, supportsAllNamespaces: (.properties[] \
  | select(.type == "olm.csv.metadata").value.installModes[] \
  | select(.type == "AllNamespaces").supported == true)} ' \
  | tee allNamespaces.json | jq -r '.image' \
  | xargs -I '{}' -n1 -P8 bash -c ' opm render {} > $(mktemp -d -p . -t olmv1-compat-bundle-XXXXXXXX)/bundle.json ' && bash -c 'cat olmv1-compat-bundle*/*.json' \
  | jq '{package, name, image, requiresWebhooks: (.properties[] \
  | select(.type == "olm.bundle.object").value.data | @base64d | fromjson \
  | select(.kind == "ClusterServiceVersion").spec.webhookdefinitions != null)}' > webhooks.json && jq -cs ' group_by(.name)[] \
  | reduce .[] as $item ({}; . *= $item) | . *= {compatible: ((.requiresWebhooks | not) and .supportsAllNamespaces)} \
  | {name, package, compatible} ' allNamespaces.json webhooks.json | jq -r '. \
  | select(.compatible == true) | .package' | sort -u
----
====
+
.Example output
[%collapsible]
====
[source,text]
----
"3scale-operator"
"amq-broker-rhel8"
"amq-online"
"amq-streams"
"amq-streams-console"
"ansible-automation-platform-operator"
"ansible-cloud-addons-operator"
"apicast-operator"
"authorino-operator"
"aws-load-balancer-operator"
"bamoe-kogito-operator"
"cephcsi-operator"
"cincinnati-operator"
"cluster-logging"
"cluster-observability-operator"
"compliance-operator"
"container-security-operator"
"cryostat-operator"
"datagrid"
"devspaces"
...
----
====

.Get a list of compatible bundle versions from a selected package by running the following command:Inspect the contents of an extension's metadata by running the following command:
+
[source,terminal]
----
$ opm render <catalog_registry_url>:<tag> \
  | jq -r --arg pkg "openshift-pipelines-operator-rh" 'select(.schema == "olm.bundle" and (.package == $pkg or $pkg == "")) \
  | {"package":.package, "name":.name, "image":.image, "supportsAllNamespaces": (.properties[] \
  | select(.type == "olm.csv.metadata").value.installModes[] \
  | select(.type == "AllNamespaces").supported == true)}' | tee allNamespaces.json | jq -r '.image' \
  | xargs -I '{}' -n1 -P8 bash -c 'opm render {} > $(mktemp -d -p . -t olmv1-compat-bundle-XXXXXXXX)/bundle.json' && bash -c 'cat olmv1-compat-bundle*/*.json' \
  | jq '{package, name, image, "requiresWebhooks": (.properties[] \
  | select(.type == "olm.bundle.object").value.data | @base64d | fromjson \
  | select(.kind == "ClusterServiceVersion").spec.webhookdefinitions != null)}' > webhooks.json && jq -cs 'group_by(.name)[] \
  | reduce .[] as $item ({}; . *= $item) | . *= {"compatible": ((.requiresWebhooks | not) and .supportsAllNamespaces)} \
  | {name,compatible}' allNamespaces.json webhooks.json && rm -rf allNamespaces.json webhooks.json olmv1-compat-bundle*
----
+
.Example command
[%collapsible]
====
[source,terminal,subs=attributes+]
----
$ opm render registry.redhat.io/redhat/redhat-operator-index:v{product-version} \
  | jq -r --arg pkg "openshift-pipelines-operator-rh" 'select(.schema == "olm.bundle" and (.package == $pkg or $pkg == "")) \
  | {"package":.package, "name":.name, "image":.image, "supportsAllNamespaces": (.properties[] \
  | select(.type == "olm.csv.metadata").value.installModes[] \
  | select(.type == "AllNamespaces").supported == true)}' | tee allNamespaces.json | jq -r '.image' \
  | xargs -I '{}' -n1 -P8 bash -c 'opm render {} > $(mktemp -d -p . -t olmv1-compat-bundle-XXXXXXXX)/bundle.json' && bash -c 'cat olmv1-compat-bundle*/*.json' \
  | jq '{package, name, image, "requiresWebhooks": (.properties[] \
  | select(.type == "olm.bundle.object").value.data | @base64d | fromjson \
  | select(.kind == "ClusterServiceVersion").spec.webhookdefinitions != null)}' > webhooks.json && jq -cs 'group_by(.name)[] \
  | reduce .[] as $item ({}; . *= $item) | . *= {"compatible": ((.requiresWebhooks | not) and .supportsAllNamespaces)} \
  | {name,compatible}' allNamespaces.json webhooks.json && rm -rf allNamespaces.json webhooks.json olmv1-compat-bundle*
----
====
+
.Example output
[%collapsible]
====
[source,text]
----
...
{"name":"openshift-pipelines-operator-rh.v1.14.3","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.14.4","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.14.5","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.15.0","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.15.1","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.15.2","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.16.0","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.16.1","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.16.2","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.16.3","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.17.0","compatible":true}
{"name":"openshift-pipelines-operator-rh.v1.17.1","compatible":true}
----
====
